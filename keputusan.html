<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Dashboard Keputusan Camat | DTSEN</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: 'Inter', sans-serif;
    background:#f4f7f6;
}
.card-custom {
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}
.stat {
    font-weight: 700;
    font-size: 1.4rem;
}
</style>
</head>

<body>

<div class="container my-5">

<h3 class="font-weight-bold mb-3">Dashboard Keputusan Camat & Dinsos</h3>
<p class="text-muted">Ringkasan risiko sosial Kecamatan Sumber</p>

<!-- KPI -->
<div class="row mb-4">
<div class="col-md-3 mb-2">
<div class="card card-custom p-3">
<p class="small text-muted mb-1">Total KK</p>
<div id="totalKK" class="stat">—</div>
</div>
</div>

<div class="col-md-3 mb-2">
<div class="card card-custom p-3">
<p class="small text-muted mb-1">Total D1</p>
<div id="totalD1" class="stat text-danger">—</div>
</div>
</div>

<div class="col-md-3 mb-2">
<div class="card card-custom p-3">
<p class="small text-muted mb-1">Total D2</p>
<div id="totalD2" class="stat text-warning">—</div>
</div>
</div>

<div class="col-md-3 mb-2">
<div class="card card-custom p-3">
<p class="small text-muted mb-1">Total Prioritas</p>
<div id="totalPrioritas" class="stat text-primary">—</div>
</div>
</div>
</div>

<!-- Ranking Risiko -->
<div class="card card-custom p-4 mb-4">
<h5 class="font-weight-bold mb-3">Ranking Desa Risiko Tertinggi</h5>
<table class="table table-bordered table-sm">
<thead>
<tr>
<th>Rank</th>
<th>Desa/Kelurahan</th>
<th>D1</th>
<th>D2</th>
<th>Skor Risiko</th>
</tr>
</thead>
<tbody id="rankingTable"></tbody>
</table>
</div>

<!-- Grafik -->
<div class="card card-custom p-4 mb-4">
<h5 class="font-weight-bold mb-3">Grafik Tekanan Sosial</h5>
<canvas id="riskChart" height="120"></canvas>
</div>

<!-- Rekomendasi -->
<div class="card card-custom p-4">
<h5 class="font-weight-bold mb-3">Rekomendasi Kebijakan Otomatis</h5>
<ul id="recommendations"></ul>
</div>

</div>

<script>
fetch('data/dtsen.json')
.then(r => r.json())
.then(data => {

    let totalKK = 0;
    let totalD1 = 0;
    let totalD2 = 0;

    let ranking = [];

    data.wilayah.forEach(w => {
        let d1 = w.desil[0];
        let d2 = w.desil[1];
        let skor = (d1 * 2) + (d2 * 1.5);

        totalKK += w.total_kk;
        totalD1 += d1;
        totalD2 += d2;

        ranking.push({
            nama: w.nama,
            d1, d2, skor
        });
    });

    document.getElementById('totalKK').innerText = totalKK.toLocaleString('id-ID');
    document.getElementById('totalD1').innerText = totalD1.toLocaleString('id-ID');
    document.getElementById('totalD2').innerText = totalD2.toLocaleString('id-ID');
    document.getElementById('totalPrioritas').innerText = (totalD1 + totalD2).toLocaleString('id-ID');

    ranking.sort((a,b) => b.skor - a.skor);

    let tbody = "";
    ranking.forEach((r,i) => {
        tbody += `
        <tr>
            <td>${i+1}</td>
            <td>${r.nama}</td>
            <td class="text-center">${r.d1}</td>
            <td class="text-center">${r.d2}</td>
            <td class="text-center font-weight-bold">${r.skor.toFixed(0)}</td>
        </tr>`;
    });

    document.getElementById('rankingTable').innerHTML = tbody;

    // Chart
    const ctx = document.getElementById('riskChart');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ranking.map(r => r.nama),
            datasets: [{
                label: 'Skor Risiko Sosial',
                data: ranking.map(r => r.skor),
                backgroundColor: '#dc3545'
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } }
        }
    });

    // Rekomendasi otomatis
    let rec = document.getElementById('recommendations');

    if (totalD1 > 1500) {
        rec.innerHTML += `<li>Prioritaskan bantuan pangan & perlindungan sosial</li>`;
    }
    if (totalD2 > 1200) {
        rec.innerHTML += `<li>Perluasan PKH dan BPNT</li>`;
    }
    rec.innerHTML += `<li>Fokus intervensi awal di: <b>${ranking[0].nama}, ${ranking[1].nama}, ${ranking[2].nama}</b></li>`;
});
</script>

</body>
</html>
