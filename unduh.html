<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Data DTSEN | TKSK & Puskesos Sumber</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<style>
body{font-family:'Inter',sans-serif;background:#f4f7f6;}
.paper{background:#fff;width:210mm;min-height:297mm;padding:15mm 20mm;margin:30px auto;box-shadow:0 0 20px rgba(0,0,0,.05);font-family:"Times New Roman", Times, serif;color:#000;}

/* ============ KOP SURAT STANDAR PEMERINTAH ============ */
.kop-surat-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 3px solid #000;
    padding-bottom: 10px;
    margin-bottom: 15px;
    position: relative;
}

.logo-box {
    width: 85px;
    flex-shrink: 0;
}

.logo-kop {
    width: 100%;
}

.teks-kop {
    text-align: center;
    flex-grow: 1;
}

/* Nama Instansi Utama */
.instansi-utama {
    font-size: 14px;
    font-weight: 600;
    margin: 0;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

/* Nama Lembaga */
.nama-lembaga {
    font-size: 18px;
    font-weight: 700;
    margin: 2px 0;
    text-transform: uppercase;
    color: #000;
}

/* Nama Program/Slogan */
.nama-program {
    font-size: 26px;
    font-weight: 800;
    margin: 4px 0;
    letter-spacing: 1px;
    color: #000;
}

/* Alamat Kantor */
.alamat-kantor {
    font-size: 11px;
    margin: 2px 0;
    font-style: normal;
}

/* Garis Kop */
.kop-line {
    border-bottom: 1px solid #000;
    margin: 2px 0 10px;
}

/* Nomor Surat */
.nomor-surat {
    font-size: 12px;
    text-align: center;
    margin-bottom: 20px;
    font-weight: 500;
}

/* ============ KOP UNTUK HALAMAN BERIKUTNYA ============ */
.kop-lanjutan {
    margin-bottom: 25px;
    border-bottom: 1px solid #666;
    padding-bottom: 8px;
}

.kop-lanjutan .instansi-singkat {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    color: #333;
}

/* ============ STYLE SURAT ============ */
.judul-surat {
    font-size: 16px;
    font-weight: 700;
    text-align: center;
    text-decoration: underline;
    margin: 20px 0;
    text-transform: uppercase;
}

.sub-judul {
    font-size: 14px;
    font-weight: 600;
    margin: 15px 0 10px;
}

.tabel-data {
    width: 100%;
    border-collapse: collapse;
    margin: 15px 0;
    font-size: 11px;
}

.tabel-data th {
    background: #f0f0f0;
    font-weight: 600;
    padding: 8px 5px;
    border: 1px solid #000;
    text-align: center;
}

.tabel-data td {
    padding: 6px 5px;
    border: 1px solid #000;
}

/* Tanda Tangan */
.tanda-tangan-container {
    margin-top: 40px;
    display: flex;
    justify-content: flex-end;
}

.tanda-tangan-box {
    width: 250px;
    text-align: center;
}

.tempat-tanggal {
    font-size: 12px;
    margin-bottom: 80px;
    text-align: right;
}

.nama-ttd {
    font-weight: 700;
    margin-top: 5px;
    text-decoration: underline;
}

.nip-ttd {
    font-size: 11px;
}

/* QR Code */
.qr-box {
    border: 1px solid #ddd;
    padding: 10px;
    background: #fff;
    display: inline-block;
    margin: 10px 0;
}

/* Footer Surat */
.footer-surat {
    font-size: 10px;
    text-align: center;
    margin-top: 30px;
    color: #666;
    border-top: 1px dashed #999;
    padding-top: 10px;
}

/* ============ MEDIA PRINT ============ */
@media print{
  body *{visibility:hidden;}
  .paper,.paper *{visibility:visible;}
  .paper{
    position:absolute;
    left:0;
    top:0;
    width:100%!important;
    margin:0!important;
    padding:15mm 20mm!important;
    box-shadow:none!important;
  }
  .no-print,#navbar,header,.container.my-5,button{
    display:none!important;
  }
  @page{
    size:A4;
    margin:15mm 20mm;
  }
}

/* Utility */
.qr-placeholder {
    width: 100px;
    height: 100px;
    background: #f9f9f9;
    border: 1px dashed #ccc;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="container py-3 bg-white no-print">
<div class="row align-items-center">
<div class="col-md-6">
<img src="assets/img/logo/logo-tksk.png" height="45" onerror="this.style.display='none'">
<img src="assets/img/logo/logo-puskesos.png" height="45" class="ml-2 border-left pl-2" onerror="this.style.display='none'">
</div>
<div class="col-md-6 text-right d-none d-md-block">
<span class="badge badge-primary px-3 py-2">
    <i class="fas fa-file-alt mr-1"></i> Satu Data Terpadu DTSEN
</span>
</div>
</div>
</header>

<!-- NAVBAR -->
<div id="navbar" class="no-print"></div>

<!-- PANEL GENERATE - HANYA SATU TOMBOL! -->
<div class="container my-5 no-print">
    <div class="row mb-3">
        <div class="col-12">
            <h3 class="font-weight-bold mb-2">
                <i class="fas fa-file-pdf mr-2 text-primary"></i>
                Cetak Dokumen DTSEN
            </h3>
            <p class="text-muted">Generate laporan dalam format surat resmi dengan kop standar pemerintahan</p>
        </div>
    </div>
    
    <div class="card shadow-sm p-4 mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <div class="row">
                    <div class="col-md-6">
                        <label class="small font-weight-bold text-uppercase">
                            <i class="fas fa-file-export mr-1"></i> Mode Laporan
                        </label>
                        <select id="mode" class="form-control">
                            <option value="agregat">Agregasi Data Kecamatan</option>
                            <option value="prioritas">Prioritas Intervensi (Desil 1-2)</option>
                            <option value="desa">Rekap Data Per Desa</option>
                        </select>
                    </div>

                    <div class="col-md-6" id="desaWrap" style="display:none;">
                        <label class="small font-weight-bold text-uppercase">
                            <i class="fas fa-map-marker-alt mr-1"></i> Pilih Desa
                        </label>
                        <select id="desaSelect" class="form-control"></select>
                    </div>
                </div>
            </div>

            <div class="col-md-4 text-right">
                <!-- SATU TOMBOL GENERATE UNTUK SEMUA -->
                <button id="btnGenerate" class="btn btn-primary btn-lg px-5">
                    <i class="fas fa-sync-alt mr-2"></i> Generate Dokumen
                </button>
                <button id="btnPrint" class="btn btn-dark btn-lg px-4 ml-2">
                    <i class="fas fa-print mr-2"></i> Cetak
                </button>
            </div>
        </div>
        
        <!-- Info Panel -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="bg-light p-3 rounded">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span class="badge badge-success mr-2">
                                <i class="fas fa-database mr-1"></i> Firebase Terkoneksi
                            </span>
                            <span class="badge badge-info">
                                <i class="fas fa-clock mr-1"></i> Update: <span id="lastUpdateInfo">Memuat...</span>
                            </span>
                        </div>
                        <div>
                            <span class="badge badge-primary" id="dataCountInfo">
                                0 wilayah terdata
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ============ DOKUMEN SURAT RESMI (AREA CETAK) ============ -->
<div class="paper" id="cetakArea">

    <!-- ======= HALAMAN 1: SURAT PENGANTAR & AGREGASI ======= -->
    <div class="halaman-1">
        <!-- KOP SURAT STANDAR PEMERINTAH -->
        <div class="kop-surat-container">
            <div class="logo-box">
                <img src="assets/img/logo/logo-tksk.png" class="logo-kop" onerror="this.style.display='none'">
            </div>
            <div class="teks-kop">
                <p class="instansi-utama">TENAGA KESEJAHTERAAN SOSIAL KECAMATAN (TKSK)</p>
                <h5 class="nama-lembaga">FORUM PUSKESOS KECAMATAN SUMBER</h5>
                <h2 class="nama-program">DARI DATA KE AKSI</h2>
                <p class="alamat-kantor">Sekretariat: Jl. Sunan Drajat No.16 Kecamatan Sumber, Kabupaten Cirebon 45611</p>
                <p class="alamat-kantor">Telp. (0231) 123456 | Email: tksk.sumber@cirebonkab.go.id</p>
            </div>
            <div class="logo-box text-right">
                <img src="assets/img/logo/logo-puskesos.png" class="logo-kop" onerror="this.style.display='none'">
            </div>
        </div>
        
        <!-- NOMOR SURAT DAN LAMPIRAN -->
        <table width="100%" style="margin-bottom: 15px; font-size: 12px;">
            <tr>
                <td width="15%">Nomor</td>
                <td width="2%">:</td>
                <td width="83%">460 / <span id="hashNomor1">DTSEN.001</span> / TKSK-SBR / 2026</td>
            </tr>
            <tr>
                <td>Sifat</td>
                <td>:</td>
                <td>Penting / Segera</td>
            </tr>
            <tr>
                <td>Lampiran</td>
                <td>:</td>
                <td><span id="lampiranCount1">3</span> (tiga) berkas</td>
            </tr>
            <tr>
                <td>Perihal</td>
                <td>:</td>
                <td><strong id="perihalSurat1">LAPORAN DATA TERPADU KESEJAHTERAAN SOSIAL</strong></td>
            </tr>
        </table>

        <!-- TUJUAN SURAT -->
        <p style="font-size: 12px; margin-bottom: 20px;">
            Yth.<br>
            1. Kepala Dinas Sosial Kabupaten Cirebon<br>
            2. Camat Sumber<br>
            di Tempat
        </p>

        <!-- ISI SURAT -->
        <div style="font-size: 12px; line-height: 1.5; text-align: justify;">
            <p>Berdasarkan hasil pendataan dan verifikasi Data Terpadu Kesejahteraan Sosial (DTSEN) di wilayah Kecamatan Sumber, bersama ini kami sampaikan laporan agregasi data kesejahteraan sosial sebagai berikut:</p>
        </div>

        <!-- KONTEN HALAMAN 1 (AGREGASI) -->
        <div id="kontenHal1" style="min-height: 200px;">
            <!-- Dinamis diisi JavaScript -->
        </div>
    </div>

    <!-- ======= HALAMAN 2: PRIORITAS DESA (PAGE BREAK) ======= -->
    <div style="page-break-before: always;" class="halaman-2">
        <!-- KOP SURAT HALAMAN LANJUTAN (SEDERHANA) -->
        <div class="kop-lanjutan">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <span class="instansi-singkat">TKSK - PUSKESOS KEC. SUMBER</span>
                <span style="font-size: 11px;">Nomor: 460 / <span id="hashNomor2">DTSEN.002</span> / TKSK-SBR / 2026</span>
            </div>
        </div>

        <!-- JUDUL SUB LAPORAN -->
        <h4 class="judul-surat">PRIORITAS INTERVENSI DTSEN</h4>
        <p style="font-size: 12px; text-align: center;">Data Prioritas Berdasarkan Desil 1 dan 2 (Sangat Miskin & Miskin)</p>
        
        <!-- KONTEN HALAMAN 2 -->
        <div id="kontenHal2" style="min-height: 250px;"></div>
        
        <!-- KETERANGAN -->
        <div style="margin-top: 20px; font-size: 11px;">
            <p><strong>Catatan:</strong> Prioritas intervensi ditetapkan berdasarkan jumlah penduduk dalam kategori Desil 1 dan 2. Wilayah dengan jumlah >400 KK masuk kategori prioritas tinggi.</p>
        </div>
    </div>

    <!-- ======= HALAMAN 3: BANSOS PER DESA ======= -->
    <div style="page-break-before: always;" class="halaman-3">
        <!-- KOP LANJUTAN -->
        <div class="kop-lanjutan">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <span class="instansi-singkat">TKSK - PUSKESOS KEC. SUMBER</span>
                <span style="font-size: 11px;">Nomor: 460 / <span id="hashNomor3">DTSEN.003</span> / TKSK-SBR / 2026</span>
            </div>
        </div>

        <h4 class="judul-surat">REKAP BANTUAN SOSIAL PER DESA</h4>
        <p style="font-size: 12px; text-align: center;">Distribusi Bantuan Sosial Berdasarkan Wilayah</p>
        
        <div id="kontenHal3" style="min-height: 250px;"></div>
    </div>

    <!-- ======= HALAMAN 4: LAYANAN + QR + TTD ======= -->
    <div style="page-break-before: always;" class="halaman-4">
        <!-- KOP LANJUTAN -->
        <div class="kop-lanjutan">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <span class="instansi-singkat">TKSK - PUSKESOS KEC. SUMBER</span>
                <span style="font-size: 11px;">Nomor: 460 / <span id="hashNomor4">DTSEN.004</span> / TKSK-SBR / 2026</span>
            </div>
        </div>

        <h4 class="judul-surat">REKAPITULASI LAYANAN SOSIAL</h4>
        <p style="font-size: 12px; text-align: center;">Data Layanan dan Program Bantuan Sosial</p>
        
        <div id="kontenHal4" style="min-height: 200px;"></div>

        <!-- BAGIAN PENUTUP SURAT -->
        <div style="margin-top: 30px;">
            <p style="font-size: 12px; text-align: justify;">
                Demikian laporan ini kami sampaikan untuk menjadi bahan evaluasi dan tindak lanjut program bantuan sosial di Kecamatan Sumber. Atas perhatian dan kerjasamanya, kami ucapkan terima kasih.
            </p>
        </div>

        <!-- TANDA TANGAN DAN QR CODE -->
        <div class="row mt-5">
            <div class="col-7">
                <div style="border: 1px solid #000; padding: 12px; font-size: 11px; background: #fcfcfc;">
                    <strong style="font-size: 12px;">⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻</strong><br>
                    <strong>VERIFIKASI DAN VALIDASI DATA:</strong><br>
                    ✓ Data bersumber dari Database DTSEN Kementerian Sosial RI<br>
                    ✓ Telah diverifikasi oleh Tenaga Kesejahteraan Sosial Kecamatan (TKSK)<br>
                    ✓ Berlaku untuk periode <span id="periodeData">2026</span><br>
                    <span style="color: #666;">* Dokumen ini ditandatangani secara elektronik</span>
                </div>
            </div>

            <div class="col-5 text-center">
                <!-- TEMPAT DAN TANGGAL -->
                <p style="font-size: 12px; margin-bottom: 5px;">Ditetapkan di : Sumber</p>
                <p style="font-size: 12px; margin-bottom: 20px;">Pada tanggal : <span id="tglSekarang">_______________</span></p>
                
                <!-- QR CODE -->
                <div style="margin-bottom: 15px;">
                    <div id="qrcode" class="qr-box"></div>
                    <p style="font-size: 9px; margin-top: 5px;">Scan untuk verifikasi dokumen</p>
                </div>
                
                <!-- NAMA PENANDATANGAN -->
                <p style="font-size: 12px; margin-bottom: 5px;">Koordinator TKSK Kecamatan Sumber,</p>
                <div style="margin-top: 50px;"></div>
                <p class="nama-ttd" style="font-size: 14px;">SHIDIQ HASANUDIN, S.IP</p>
                <p style="font-size: 10px; margin-top: 10px; color: #666;">
                    ID Verifikasi: <span id="hashID">DTSEN-SBR-2026-001</span>
                </p>
            </div>
        </div>

        <!-- FOOTER SURAT -->
        <div class="footer-surat">
            <span>Dokumen ini diterbitkan secara elektronik dan sah tanpa tanda tangan basah</span><br>
            <span>⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻⸻</span>
        </div>
    </div>

</div> <!-- Tutup paper -->

<!-- SCRIPT EXTERNAL -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script type="module" src="js/unduh.js"></script>

</body>
</html>
